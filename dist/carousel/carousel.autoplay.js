/*! License details at fancyapps.com/license */
import{isPlainObject as t}from"../utils/isPlainObject.js";const e={autoStart:!0,pauseOnHover:!0,showProgressbar:!0,timeout:2e3},n=()=>{let n,o,i=!1,l=!1,r=!1,a=null;function s(o){const i=null==n?void 0:n.getOptions().Autoplay;let l=(t(i)?Object.assign(Object.assign({},e),i):e)[o];return l&&"function"==typeof l&&n?l(n):l}function u(){clearTimeout(o),o=void 0}function f(){if(!i)return;if(r)return;if(l)return;if(o)return;if(!(null==n?void 0:n.isSettled()))return;if(function(){var t;const e=(null===(t=null==n?void 0:n.getPage())||void 0===t?void 0:t.slides)||[];for(const t of e)if(0===t.state)return!0;return!1}())return;!function(){var t,e,o,i;if(!n)return;if(g(),!s("showProgressbar"))return;let l=s("progressbarParentEl");!l&&(null===(t=n.getPlugins().Toolbar)||void 0===t?void 0:t.isEnabled())&&(l=n.getContainer());if(!l&&!0!==(null===(e=n.getPlugins().Toolbar)||void 0===e?void 0:e.isEnabled())){const t=(null===(o=n.getPages()[0])||void 0===o?void 0:o.slides)||[],e=(null===(i=n.getPage())||void 0===i?void 0:i.slides)||[];1===t.length&&1===e.length&&(l=e[0].el)}l||(l=n.getViewport());if(!l)return;a=document.createElement("div"),a.classList.add("f-progressbar"),l.prepend(a);const r=s("timeout")||1e3;a.style.animationDuration=`${r}ms`}();const t=s("timeout");o=setTimeout((()=>{n&&i&&!l&&(n.isInfinite()||n.getPageIndex()!==n.getPages().length-1?n.next():n.goTo(0))}),t)}function d(){var t,e;if(!n||n.getPages().length<2||!1===n.getOptions().Autoplay)return;if(i)return;i=!0,n.emit("autoplay:start",s("timeout")),null===(t=n.getContainer())||void 0===t||t.classList.add("has-autoplay"),null===(e=n.getTween())||void 0===e||e.on("start",y);const o=null==n?void 0:n.getContainer();o&&s("pauseOnHover")&&matchMedia("(hover: hover)").matches&&(o.addEventListener("mouseenter",b,!1),o.addEventListener("mouseleave",E,!1)),n.on("change",h),n.on("settle",P),n.on("contentReady",m),n.on("panzoom:touchStart",c),n.on("panzoom:wheel",c),n.isSettled()&&f()}function c(){var t,e;if(u(),g(),i&&n){n.emit("autoplay:end"),null===(t=n.getContainer())||void 0===t||t.classList.remove("has-autoplay"),null===(e=n.getTween())||void 0===e||e.off("start",y);const o=null==n?void 0:n.getContainer();o&&(o.removeEventListener("mouseenter",b,!1),o.removeEventListener("mouseleave",E,!1))}n&&(n.off("change",h),n.off("settle",P),n.off("contentReady",m),n.off("panzoom:touchStart",c),n.off("panzoom:wheel",c)),i=!1,l=!1}function g(){a&&(a.remove(),a=null)}function v(){n&&n.getPages().length>1&&s("autoStart")&&d()}function m(){n&&f()}function p(t,e){const n=e.target;n&&!e.defaultPrevented&&"toggle"===n.dataset.autoplayAction&&w.toggle()}function h(){!n||!(null==n?void 0:n.isInfinite())&&n.getPageIndex()===n.getPages().length-1?c():(g(),u())}function P(){f()}function y(){u(),g()}function b(){r=!0,i&&(g(),u())}function E(){r=!1,i&&!l&&(null==n?void 0:n.isSettled())&&f()}const w={init:function(t){n=t,n.on("ready",v),n.on("click",p)},destroy:function(){c(),null==n||n.off("ready",v),null==n||n.off("click",p),n=void 0},isEnabled:()=>i,pause:function(){l=!0,u()},resume:function(){l=!1,i&&!r&&f()},start(){d()},stop(){c()},toggle(){i?c():d()}};return w};export{n as Autoplay};
