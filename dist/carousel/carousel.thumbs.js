/*! License details at fancyapps.com/license */
import{isPlainObject as t}from"../utils/isPlainObject.js";import{extend as n}from"../utils/extend.js";import{replaceAll as e}from"../utils/replaceAll.js";import{clamp as o}from"../utils/clamp.js";import{Sync as i}from"./carousel.sync.js";import{Lazyload as l}from"./carousel.lazyload.js";import{addClass as s}from"../utils/addClass.js";const r={Carousel:{Lazyload:{showLoading:!1}},minCount:2,showOnStart:!0,thumbTpl:'<button aria-label="Slide to #{{page}}"><img draggable="false" alt="{{alt}}" data-lazy-src="{{src}}" /></button>',type:"modern"};let u;const a=()=>{let a,d,c,f=0,m=0,g=!0;function h(n){const e=null==a?void 0:a.getOptions().Thumbs;let o=(t(e)?Object.assign(Object.assign({},r),e):r)[n];return o&&"function"==typeof o&&a?o(a):o}function v(){if(!a)return!1;if(!1===(null==a?void 0:a.getOptions().Thumbs))return!1;let t=0;for(const n of a.getSlides())n.thumbSrc&&t++;return t>=h("minCount")}function p(){return"modern"===h("type")}function b(t=!1){var n;const e=null==a?void 0:a.getContainer();if(!a||!e||c)return;if(!v())return;const o=(null===(n=h("Carousel"))||void 0===n?void 0:n.classes)||{};if(o.container=o.container||"f-thumbs",!c){const t=e.nextElementSibling;(null==t?void 0:t.classList.contains(o.container))&&(c=t)}if(!c){c=document.createElement("div");const t=h("parentEl");t?t.insertAdjacentElement("beforeend",c):e.insertAdjacentElement("afterend",c)}s(c,o.container),s(c,"f-thumbs"),s(c,`is-${h("type")}`),s(c,"is-syncing"),t&&(c.style.maxHeight="0px")}function y(t){const n=t.thumb?t.thumb instanceof HTMLImageElement?t.thumb.src:t.thumb:t.thumbSrc||void 0,o=void 0===t.thumbAlt?`Thumbnail #${t.index}`:t.thumbAlt+"";let i=h("thumbTpl");return i=e(i,"{{alt}}",o),i=e(i,"{{src}}",n+""),i=e(i,"{{index}}",`${t.index}`),i=e(i,"{{page}}",`${t.index||1}`),{html:i,class:t.thumbClass}}function S(){var t;if(!u)return;if(!a||!c||d)return;const e=[];for(const t of a.getSlides())e.push(y(t));e.length&&(d=u(c,n({},{Sync:{target:a},Lazyload:{preload:1},slides:e,classes:{container:"f-thumbs",viewport:"f-thumbs__viewport",slide:"f-thumbs__slide"},center:!0,fill:!p(),infinite:!1,dragFree:!0,rtl:a.getOptions().rtl||!1,slidesPerPage:t=>{let n=0;return p()&&(!function(){if(!p())return;if(!c)return;const t=t=>c&&parseFloat(getComputedStyle(c).getPropertyValue("--f-thumb-"+t))||0;f=t("width"),m=t("clip-width")}(),n=4*(f-m)),t&&t.getTotalSlideDim()<=t.getViewportDim()-n?1/0:1}},r.Carousel||{},h("Carousel")||{}),{Sync:i,Lazyload:l}),d.on("ready",(()=>{null==a||a.emit("thumbs:ready"),p()&&(null==a||a.on("change",w),null==a||a.on("render",j))})),d.on("destroy",(()=>{null==a||a.emit("thumbs:destroy")})),d.init(),null===(t=d.getGestures())||void 0===t||t.on("start",(()=>{g=!1})),d.on("click",((t,n)=>{const e=n.target;if(e){const t=e.matches("button")?e:e.firstElementChild;t&&t.matches("button")&&(n.preventDefault(),t.focus({preventScroll:!0}))}})),s(a.getContainer(),"has-thumbs"),L())}function x(){v()&&h("showOnStart")&&(b(),S())}function C(){var t;v()&&(null==a||a.on("addSlide",E),null==a||a.on("click",T),null===(t=null==a?void 0:a.getGestures())||void 0===t||t.on("start",P))}function P(){var t,n;g=!0;(null===(t=document.activeElement)||void 0===t?void 0:t.closest(".f-thumbs"))&&(null===(n=document.activeElement)||void 0===n||n.blur())}function j(){var t,n;null==c||c.classList.toggle("is-syncing",!1===(null==a?void 0:a.hasNavigated())||(null===(t=null==a?void 0:a.getTween())||void 0===t?void 0:t.isRunning())),L(),(null===(n=null==a?void 0:a.getGestures())||void 0===n?void 0:n.isPointerDown())&&function(){if(!p())return;if(!a||!d)return;if(!g)return;const t=d.getTween(),n=d.getPages(),e=a.getPageIndex()||0,i=a.getPageProgress()||0;if(!(a&&n&&n[e]&&t))return;const l=t.isRunning()?t.getCurrentValues().pos:d.getPosition();if(void 0===l)return;let s=n[e].pos+i*(f-m);s=o(n[0].pos,s,n[n.length-1].pos),t.from({pos:l}).to({pos:s}).start()}()}function w(){g=!0}function E(t,n){null==d||d.add(y(n),n.index)}function T(t,n){const e=n.target;e&&!n.defaultPrevented&&"toggle"===e.dataset.thumbsAction&&function(){if(c||(b(!0),S()),!c)return;const t=(null==d?void 0:d.isVertical())?"maxWidth":"maxHeight",n=c.style[t];c.style[t]=n?"":"0px"}()}function L(){if(!p())return;if(!a||!d)return;const t=(null==d?void 0:d.getSlides())||[];let n=-.5*f;for(const e of t){const t=e.el;if(!t)continue;let o=a.getPageProgress(e.index)||0;o=Math.max(-1,Math.min(1,o)),o>-1&&o<1&&(n+=.5*f*(1-Math.abs(o))),o=Math.round(1e4*o)/1e4,n=Math.round(1e4*n)/1e4,t.style.setProperty("--progress",`${Math.abs(o)}`),t.style.setProperty("--shift",`${(null==a?void 0:a.isRTL())?-1*n:n}px`),o>-1&&o<1&&(n+=.5*f*(1-Math.abs(o)))}}return{init:function(t,n){u=n,a=t,a.on("ready",C),a.on("initSlides",x)},destroy:function(){var t,n;null==a||a.off("ready",C),null==a||a.off("initSlides",x),null==a||a.off("change",w),null==a||a.off("render",j),null==a||a.off("addSlide",E),null==a||a.off("click",T),null===(t=null==a?void 0:a.getGestures())||void 0===t||t.off("start",P),null===(n=null==a?void 0:a.getContainer())||void 0===n||n.classList.remove("has-thumbs"),a=void 0,null==d||d.destroy(),d=void 0,null==c||c.remove(),c=void 0},getCarousel:function(){return d},getContainer:function(){return c},isEnabled:function(){return v()}}};export{a as Thumbs};
