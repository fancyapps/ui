/*! License details at fancyapps.com/license */
import{isPlainObject as t}from"../utils/isPlainObject.js";import{extend as e}from"../utils/extend.js";import{replaceAll as n}from"../utils/replaceAll.js";import{clamp as i}from"../utils/clamp.js";import{Sync as o}from"./carousel.sync.js";import{Lazyload as l}from"./carousel.lazyload.js";import{addClass as s}from"../utils/addClass.js";const r={Carousel:{Lazyload:{showLoading:!1}},minCount:2,showOnStart:!0,thumbTpl:'<button aria-label="Slide to #{{page}}"><img draggable="false" alt="{{alt}}" data-lazy-src="{{src}}" /></button>',type:"modern"};let u;const a=()=>{let a,d,c,f=0,m=0,g=!0;function h(e){const n=null==a?void 0:a.getOptions().Thumbs;let i=(t(n)?Object.assign(Object.assign({},r),n):r)[e];return i&&"function"==typeof i&&a?i(a):i}function v(){if(!a)return!1;if(!1===(null==a?void 0:a.getOptions().Thumbs))return!1;let t=0;for(const e of a.getSlides())e.thumbSrc&&t++;return t>=h("minCount")}function p(){return"modern"===h("type")}function b(t=!1){var e;const n=null==a?void 0:a.getContainer();if(!a||!n||c)return;if(!v())return;if(!c){const t=n.nextElementSibling;(null==t?void 0:t.classList.contains("f-thumbs"))&&(c=t)}if(!c){c=document.createElement("div");const t=h("parentEl");t?t.insertAdjacentElement("beforeend",c):n.insertAdjacentElement("afterend",c)}const i=null===(e=h("Carousel"))||void 0===e?void 0:e.classes;(null==i?void 0:i.container)&&s(c,i.container),s(c,"f-thumbs"),s(c,`is-${h("type")}`),s(c,"is-syncing"),t&&(c.style.maxHeight="0px")}function y(t){const e=t.thumb?t.thumb instanceof HTMLImageElement?t.thumb.src:t.thumb:t.thumbSrc||void 0,i=void 0===t.thumbAlt?`Thumbnail #${t.index}`:t.thumbAlt+"";let o=h("thumbTpl");return o=n(o,"{{alt}}",i),o=n(o,"{{src}}",e+""),o=n(o,"{{index}}",`${t.index}`),o=n(o,"{{page}}",`${t.index||1}`),{html:o,class:t.thumbClass}}function S(){var t;if(!u)return;if(!a||!c||d)return;const n=[];for(const t of a.getSlides())n.push(y(t));n.length&&(d=u(c,e({},{Sync:{target:a},Lazyload:{preload:1},slides:n,classes:{container:"f-thumbs",viewport:"f-thumbs__viewport",slide:"f-thumbs__slide"},initialSlide:a.getOptions().initialPage,center:!0,fill:!p(),infinite:!1,dragFree:!0,rtl:a.getOptions().rtl||!1,slidesPerPage:t=>{let e=0;return p()&&(!function(){if(!p())return;if(!c)return;const t=t=>c&&parseFloat(getComputedStyle(c).getPropertyValue("--f-thumb-"+t))||0;f=t("width"),m=t("clip-width")}(),e=4*(f-m)),t&&t.getTotalSlideDim()<=t.getViewportDim()-e?1/0:1}},r.Carousel||{},h("Carousel")||{}),{Sync:o,Lazyload:l}),d.on("ready",(()=>{null==a||a.emit("thumbs:ready")})),d.on("destroy",(()=>{null==a||a.emit("thumbs:destroy")})),d.init(),null===(t=d.getGestures())||void 0===t||t.on("start",(()=>{g=!1})),d.on("click",((t,e)=>{const n=e.target;if(n){const t=n.matches("button")?n:n.firstElementChild;t&&t.matches("button")&&(e.preventDefault(),t.focus({preventScroll:!0}))}})),s(a.getContainer(),"has-thumbs"),L())}function x(){v()&&h("showOnStart")&&(b(),S())}function C(){var t;v()&&(null==a||a.on("addSlide",E),null==a||a.on("click",T),null===(t=null==a?void 0:a.getGestures())||void 0===t||t.on("start",P))}function P(){var t,e;g=!0;(null===(t=document.activeElement)||void 0===t?void 0:t.closest(".f-thumbs"))&&(null===(e=document.activeElement)||void 0===e||e.blur())}function j(){var t,e;null==c||c.classList.toggle("is-syncing",!1===(null==a?void 0:a.hasNavigated())||(null===(t=null==a?void 0:a.getTween())||void 0===t?void 0:t.isRunning())),L(),(null===(e=null==a?void 0:a.getGestures())||void 0===e?void 0:e.isPointerDown())&&function(){if(!p())return;if(!a||!d)return;if(!g)return;const t=d.getTween(),e=d.getPages(),n=a.getPageIndex()||0,o=a.getPageProgress()||0;if(!(a&&e&&e[n]&&t))return;const l=t.isRunning()?t.getCurrentValues().pos:d.getPosition();if(void 0===l)return;let s=e[n].pos+o*(f-m);s=i(e[0].pos,s,e[e.length-1].pos),t.from({pos:l}).to({pos:s}).start()}()}function w(){g=!0}function E(t,e){null==d||d.add(y(e),e.index)}function T(t,e){const n=e.target;n&&!e.defaultPrevented&&"toggle"===n.dataset.thumbsAction&&function(){if(c||(b(!0),S()),!c)return;const t=(null==d?void 0:d.isVertical())?"maxWidth":"maxHeight",e=c.style[t];c.style[t]=e?"":"0px"}()}function L(){if(!p())return;if(!a||!d)return;const t=(null==d?void 0:d.getSlides())||[];let e=-.5*f;for(const n of t){const t=n.el;if(!t)continue;let i=a.getPageProgress(n.index)||0;i=Math.max(-1,Math.min(1,i)),i>-1&&i<1&&(e+=.5*f*(1-Math.abs(i))),i=Math.round(1e4*i)/1e4,e=Math.round(1e4*e)/1e4,t.style.setProperty("--progress",`${Math.abs(i)}`),t.style.setProperty("--shift",`${(null==a?void 0:a.isRTL())?-1*e:e}px`),i>-1&&i<1&&(e+=.5*f*(1-Math.abs(i)))}}return{init:function(t,e){u=e,a=t,a.on("ready",C),a.on("initSlides",x),a.on("render",j),a.on("change",w)},destroy:function(){var t,e;null==a||a.off("ready",C),null==a||a.off("initSlides",x),null==a||a.off("render",j),null==a||a.off("change",w),null==a||a.off("addSlide",E),null==a||a.off("click",T),null===(t=null==a?void 0:a.getGestures())||void 0===t||t.off("start",P),null===(e=null==a?void 0:a.getContainer())||void 0===e||e.classList.remove("has-thumbs"),a=void 0,null==d||d.destroy(),d=void 0,null==c||c.remove(),c=void 0},getCarousel:function(){return d},getContainer:function(){return c},isEnabled:function(){return v()}}};export{a as Thumbs};
