/*! License details at fancyapps.com/license */
import{canUseDOM as t}from"../utils/canUseDOM.js";let n,e=!1,o=!1,i=!1,l=!1;const r=()=>{const t=new URL(document.URL).hash,n=t.slice(1).split("-"),e=n[n.length-1],o=e&&/^\+?\d+$/.test(e)&&parseInt(n.pop()||"1",10)||1;return{hash:t,slug:n.join("-"),index:o}},s=()=>{if(!n||n.getInstance())return;const{slug:t,index:e}=r();if(!t)return;let o=document.querySelector(`[data-slug="${t}"]`);if(o&&o.dispatchEvent(new CustomEvent("click",{bubbles:!0,cancelable:!0})),!n||n.getInstance())return;const i=document.querySelectorAll(`[data-fancybox="${t}"]`);i.length&&(o=i[e-1],o&&o.dispatchEvent(new CustomEvent("click",{bubbles:!0,cancelable:!0})))},a=()=>{var t,e,o;if(!n)return;if(i)return;const a=null==n?void 0:n.getInstance();if(!1===(null==a?void 0:a.getOptions().Hash))return;const{slug:c,index:u}=r(),d=(null===(t=null==a?void 0:a.getSlide())||void 0===t?void 0:t.fancybox)||(null===(e=null==a?void 0:a.getSlide())||void 0===e?void 0:e.slug)||void 0;a&&d&&(c===d?null===(o=a.getCarousel())||void 0===o||o.goTo(u-1):(l=!0,a.close(),l=!1)),s()},c=()=>{n&&setTimeout((()=>{e=!0,s(),e=!1,window.addEventListener("hashchange",a,!1)}),300)},u=()=>{let t,n="auto",s="";function a(){if(!(null==t?void 0:t.isTopMost()))return;if(!1===(null==t?void 0:t.getOptions().Hash))return;const i=null==t?void 0:t.getCarousel();if(!i)return;const{hash:l,slug:a}=r(),u=null==t?void 0:t.getSlide();if(!u)return;let d=u.fancybox||"",h=parseInt(u.index+"",10)+1;if(!d)return;let f=`#${d}-${h}`;if(l!==f&&(s=l),history.scrollRestoration&&(n=history.scrollRestoration,history.scrollRestoration="manual"),i.on("change",c),!e)if(d===a)try{window.history.replaceState({},document.title,window.location.pathname+window.location.search+f)}catch(t){}else try{window.history.pushState({},document.title,window.location.pathname+window.location.search+f),o=!0}catch(t){}}function c(){if(!(null==t?void 0:t.isTopMost()))return;const{slug:n}=r(),e=null==t?void 0:t.getSlide();if(!e)return;let o=e.fancybox||"",l=`#${o}-${e.index+1}`;if(o===n){i=!0;try{window.history.replaceState({},document.title,window.location.pathname+window.location.search+l)}catch(t){}i=!1}}function u(){if(!(null==t?void 0:t.isTopMost()))return;if(!1===(null==t?void 0:t.getOptions().Hash))return;const n=null==t?void 0:t.getSlide();if(!n)return;if(n.fancybox&&!l){i=!0;try{o&&!e?window.history.back():window.history.replaceState({},document.title,window.location.pathname+window.location.search+s)}catch(t){}i=!1}}return{init:function(n){t=n,t.on("ready",a),t.on("close",u)},destroy:function(){null==t||t.off("ready",a),null==t||t.off("close",u);const e=null==t?void 0:t.getCarousel();e&&e.off("change",c),t=void 0,history.scrollRestoration&&n&&(history.scrollRestoration=n)}}};u.startFromUrl=s,u.setup=function(e){n||(n=e,t()&&(/complete|interactive|loaded/.test(document.readyState)?c():document.addEventListener("DOMContentLoaded",c)))};export{u as Hash};
