/*! License details at fancyapps.com/license */
import{canUseDOM as t}from"../utils/canUseDOM.js";let e,n=!1,o=!1,r=!1,i=!1;const l=()=>{const t=new URL(document.URL).hash,e=t.slice(1).split("-"),n=e[e.length-1],o=n&&/^\+?\d+$/.test(n)&&parseInt(e.pop()||"1",10)||1;return{urlHash:t,urlSlug:e.join("-"),urlIndex:o}},s=()=>{const t=null==e?void 0:e.getInstance();return!(!t||1!=t.getState())},u=()=>{if(!e)return;if(s())return;const{urlSlug:t,urlIndex:n}=l();if(!t)return;let o=document.querySelector(`[data-slug="${t}"]`);if(o&&o.dispatchEvent(new CustomEvent("click",{bubbles:!0,cancelable:!0})),s())return;const r=document.querySelectorAll(`[data-fancybox="${t}"]`);if(!r.length)return;const i=r[n-1];i&&i.dispatchEvent(new CustomEvent("click",{bubbles:!0,cancelable:!0}))},a=()=>{if(!e)return;if(r)return;const t=null==e?void 0:e.getInstance(),n=null==t?void 0:t.getCarousel();if(!1===(null==t?void 0:t.getOptions().Hash))return;const{urlSlug:o,urlIndex:s}=l();if(t&&n){const e=n.getSlides();for(const t of e||[])if(o===t.slug||o===t.fancybox&&t.index===s-1)return void n.goTo(t.index);i=!0,t.close(),i=!1}u()},c=()=>{e&&setTimeout((()=>{n=!0,u(),n=!1,window.addEventListener("hashchange",a,!1)}),300)},d=()=>{let t,e="auto",s="";function u(){var r,i,u,c;if(!t||!t.isTopMost())return;if(!1===t.getOptions().Hash)return;const d=t.getCarousel();if(!d)return;const{urlHash:f,urlSlug:g}=l(),h=t.getSlide();if(!h)return;let w=h.slug||h.fancybox||"",p=parseInt(h.index+"",10)+1;if(!w)return;let y=h.slug?`#${h.slug}`:`#${w}-${p}`;if(((null===(i=null===(r=t.getCarousel())||void 0===r?void 0:r.getPages())||void 0===i?void 0:i.length)||0)<2&&(y=`#${w}`),f!==y&&(s=f),history.scrollRestoration&&(e=history.scrollRestoration,history.scrollRestoration="manual"),d.on("change",a),n)return void(null===(u=t.getOptions().sync)||void 0===u||u.goTo((null===(c=t.getCarousel())||void 0===c?void 0:c.getPageIndex())||0));const v=w!==g;try{window.history[v?"pushState":"replaceState"]({},document.title,window.location.pathname+window.location.search+y)}catch(t){}v&&(o=!0)}function a(){if(!t||!t.isTopMost())return;if(!1===t.getOptions().Hash)return;const e=t.getSlide();if(!e)return;let n=e.slug||e.fancybox||"",o=e.index+1,i=e.slug?`#${e.slug}`:`#${n}-${o}`;r=!0;try{window.history.replaceState({},document.title,window.location.pathname+window.location.search+i)}catch(t){}r=!1}function c(){if(i)return;if(!t||!t.isTopMost())return;if(!1===t.getOptions().Hash)return;const e=t.getSlide();if(!e)return;if(e.fancybox||""){r=!0;try{!o||n||function(){if(window.parent===window)return!1;try{var t=window.frameElement}catch(e){t=null}return null===t?"data:"===location.protocol:t.hasAttribute("sandbox")}()?window.history.replaceState({},document.title,window.location.pathname+window.location.search+s):window.history.back()}catch(t){}r=!1}}return{init:function(e){t=e,t.on("ready",u),t.on("close",c)},destroy:function(){null==t||t.off("ready",u),null==t||t.off("close",c);const n=null==t?void 0:t.getCarousel();n&&n.off("change",a),t=void 0,history.scrollRestoration&&e&&(history.scrollRestoration=e)}}};d.startFromUrl=u,d.setup=function(n){e||(e=n,t()&&(/complete|interactive|loaded/.test(document.readyState)?c():document.addEventListener("DOMContentLoaded",c)))};export{d as Hash};
