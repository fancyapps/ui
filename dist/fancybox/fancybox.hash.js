/*! License details at fancyapps.com/license */
import{canUseDOM as t}from"../utils/canUseDOM.js";let e,n,o=!1,r=!1,i=!1;const l=()=>{const t=new URL(document.URL).hash,e=t.slice(1).split("-"),n=e[e.length-1],o=n&&/^\+?\d+$/.test(n)&&parseInt(e.pop()||"1",10)||1;return{urlHash:t,urlSlug:e.join("-"),urlIndex:o}},s=()=>{const t=null==e?void 0:e.getInstance();return!(!t||1!=t.getState())},a=()=>{if(!e)return;if(s())return;const{urlSlug:t,urlIndex:n}=l();if(!t)return;let o=document.querySelector(`[data-slug="${t}"]`);o&&e.fromTriggerEl(o),s()||(o=document.querySelectorAll(`[data-fancybox="${t}"]`)[n-1],o&&e.fromTriggerEl(o,{startIndex:n-1})),s()&&o&&!o.closest("[inert]")&&o.scrollIntoView({behavior:"instant",block:"center",inline:"center"})},u=()=>{if(!e)return;if(r)return;const t=null==e?void 0:e.getInstance(),n=null==t?void 0:t.getCarousel();if(!1===(null==t?void 0:t.getOptions().Hash))return;const{urlSlug:s,urlIndex:u}=l();if(t&&n){const e=n.getSlides();for(const t of e||[])if(s===t.slug||s===t.fancybox&&t.index===u-1)return o=!1,void n.goTo(t.index);i=!0,t.close(),i=!1}a()},c=()=>{e&&(n=setTimeout((()=>{a()}),300),window.addEventListener("hashchange",u,!1))},d=()=>{let t,e="auto",s="";function a(){var n,r;if(!t||!t.isTopMost())return;if(!1===t.getOptions().Hash)return;const i=t.getCarousel();if(!i)return;const{urlHash:a,urlSlug:c}=l(),d=t.getSlide();if(!d)return;let f=d.slug||d.fancybox||"",g=parseInt(d.index+"",10)+1;if(!f)return;let h=d.slug?`#${d.slug}`:`#${f}-${g}`;((null===(r=null===(n=t.getCarousel())||void 0===n?void 0:n.getPages())||void 0===r?void 0:r.length)||0)<2&&(h=`#${f}`),a!==h&&(s=a),history.scrollRestoration&&(e=history.scrollRestoration,history.scrollRestoration="manual"),i.on("change",u);const w=f!==c;try{window.history[w?"pushState":"replaceState"]({},document.title,window.location.pathname+window.location.search+h),w&&(o=!0)}catch(t){}}function u(){if(!t||!t.isTopMost())return;if(!1===t.getOptions().Hash)return;const e=t.getSlide();if(!e)return;let n=e.slug||e.fancybox||"",o=e.index+1,i=e.slug?`#${e.slug}`:`#${n}-${o}`;r=!0;try{window.history.replaceState({},document.title,window.location.pathname+window.location.search+i)}catch(t){}r=!1}function c(){if(i)return;if(!t||!t.isTopMost())return;if(!1===t.getOptions().Hash)return;const e=t.getSlide();if(!e)return;if(e.fancybox||""){r=!0;try{o&&!function(){if(window.parent===window)return!1;try{var t=window.frameElement}catch(e){t=null}return null===t?"data:"===location.protocol:t.hasAttribute("sandbox")}()?window.history.back():window.history.replaceState({},document.title,window.location.pathname+window.location.search+s)}catch(t){}r=!1}}return{init:function(e){clearTimeout(n),t=e,t.on("ready",a),t.on("close",c)},destroy:function(){null==t||t.off("ready",a),null==t||t.off("close",c);const n=null==t?void 0:t.getCarousel();n&&n.off("change",u),t=void 0,history.scrollRestoration&&e&&(history.scrollRestoration=e)}}};d.startFromUrl=a,d.setup=function(n){e||(e=n,t()&&(/complete|interactive|loaded/.test(document.readyState)?c():document.addEventListener("DOMContentLoaded",c)))};export{d as Hash};
