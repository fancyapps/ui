/*! License details at fancyapps.com/license */
import{clamp as n}from"../utils/clamp.js";import{isEqual as t}from"../utils/isEqual.js";const e=function(n){for(const t of s)t.getState()===i.Running&&t.tick(n-a);a=n,u=window.requestAnimationFrame(e)};var i,o,r;!function(n){n[n.Initializing=0]="Initializing",n[n.Running=1]="Running",n[n.Paused=2]="Paused",n[n.Completed=3]="Completed",n[n.Destroyed=4]="Destroyed"}(i||(i={})),function(n){n[n.Spring=0]="Spring",n[n.Ease=1]="Ease"}(o||(o={})),function(n){n[n.Loop=0]="Loop",n[n.Reverse=1]="Reverse"}(r||(r={}));const s=new Set;let u=null,a=0;function c(){let e=i.Initializing,u=o.Ease,a=0,f=0,l=c.Easings.Linear,g=500,p=0,m=0,d=0,b=0,S=1/0,h=.01,y=.01,E=!1,R={},M=null,j={},w={},v={},O=0,C=0,L=r.Loop,I=c.Easings.Linear;const D=new Map;function z(n,...t){for(const e of D.get(n)||[])e(...t)}function N(n){return f=0,n?M=setTimeout((()=>{V()}),n):V(),x}function V(){e=i.Running,z("start",j,w)}function q(){if(e=i.Completed,v={},z("end",j),e===i.Completed)if(a<O){if(a++,L===r.Reverse){const n=Object.assign({},R);R=Object.assign({},w),w=n}N(C)}else a=0;return x}const x={getState:function(){return e},easing:function(n){return l=n,u=o.Ease,v={},x},duration:function(n){return g=n,x},spring:function(n={}){u=o.Spring;const t={velocity:0,mass:1,tension:170,friction:26,restDelta:.1,restSpeed:.1,maxSpeed:1/0,clamp:!0},{velocity:e,mass:i,tension:r,friction:s,restDelta:a,restSpeed:c,maxSpeed:f,clamp:l}=Object.assign(Object.assign({},t),n);return p=e,m=i,d=r,b=s,y=a,h=c,S=f,E=l,v={},x},isRunning:function(){return e===i.Running},isSpring:function(){return u===o.Spring},from:function(n){return j=Object.assign({},n),x},to:function(n){return w=n,x},repeat:function(n,t=0,e=r.Loop,i){return O=n,C=t,L=e,I=i||l,x},on:function(n,t){var e,i;return e=n,i=t,D.set(e,[...D.get(e)||[],i]),x},off:function(n,t){var e,i;return e=n,i=t,D.has(e)&&D.set(e,D.get(e).filter((n=>n!==i))),x},start:function(n){return e=i.Initializing,R=Object.assign({},j),t(R,w)||(s.add(this),N(n)),x},pause:function(){return M&&(clearTimeout(M),M=null),e===i.Running&&(e=i.Paused,z("pause",j)),x},end:q,tick:function(s){s>50&&(s=50),f+=s;let a=0,c=!1;if(e!==i.Running)return x;if(u===o.Ease){a=n(0,f/g,1),c=1===a;const t=L===r.Reverse?I:l;for(const n in j)j[n]=R[n]+(w[n]-R[n])*t(a)}if(u===o.Spring){const t=.001*s;let e=0;for(const i in j){const o=w[i];let r=j[i];if("number"!=typeof o||isNaN(o)||"number"!=typeof r||isNaN(r))continue;if(Math.abs(o-r)<=y){j[i]=o,v[i]=0;continue}v[i]||("object"==typeof p&&"number"==typeof p[i]?v[i]=p[i]:v[i]="number"==typeof p?p:0);let s=v[i];s=n(-1*Math.abs(S),s,Math.abs(S));const u=s*m*b;s+=((r>o?-1:1)*(Math.abs(o-r)*d)-u)/m*t,r+=s*t;const a=j[i]>o?r<o:r>o;let c=Math.abs(s)<h&&Math.abs(o-r)<=y;E&&a&&(c=!0),c?(r=o,s=0):e++,j[i]=r,v[i]=s}c=!e}const M=Object.assign({},w);return z("step",j,R,w,a),c&&e===i.Running&&t(w,M)&&(e=i.Completed,q()),x},getStartValues:function(){return R},getCurrentValues:function(){return j},getCurrentVelocities:function(){return v},getEndValues:function(){return w},destroy:function(){e=i.Destroyed,M&&(clearTimeout(M),M=null),R=j=w={},s.delete(this)}};return x}c.destroy=()=>{for(const n of s)n.destroy();u&&(cancelAnimationFrame(u),u=null)},c.Easings={Linear:function(n){return n},EaseIn:function(n){return 0===n?0:Math.pow(2,10*n-10)},EaseOut:function(n){return 1===n?1:1-Math.pow(2,-10*n)},EaseInOut:function(n){return 0===n?0:1===n?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2}},u=window.requestAnimationFrame(e);export{c as Tween,r as TweenRepeatType,i as TweenState};
