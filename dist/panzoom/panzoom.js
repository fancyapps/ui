/*! License details at fancyapps.com/license */
import{isString as e}from"../utils/isString.js";import{isNode as t}from"../utils/isNode.js";import{getScrollableParent as n}from"../utils/getScrollableParent.js";import{stringToHtml as o}from"../utils/strToHtml.js";import{clamp as i}from"../utils/clamp.js";import{Tween as a}from"../libs/tween.js";import{getMidpoint as s,getChangedPosition as r,Gestures as l}from"../libs/gestures.js";import{en_EN as c}from"./l10n/en_EN.js";import{addClass as u}from"../utils/addClass.js";import{removeClass as d}from"../utils/removeClass.js";import{toggleClass as f}from"../utils/toggleClass.js";const g=e=>{e.cancelable&&e.preventDefault()},h=(e,t=1e4)=>(e=parseFloat(e+"")||0,Math.round((e+Number.EPSILON)*t)/t),m=e=>e instanceof HTMLImageElement;var p,v;!function(e){e.Reset="reset",e.Zoom="zoom",e.ZoomIn="zoomIn",e.ZoomOut="zoomOut",e.ZoomTo="zoomTo",e.ToggleCover="toggleCover",e.ToggleFull="toggleFull",e.ToggleMax="toggleMax",e.IterateZoom="iterateZoom",e.Pan="pan",e.Swipe="swipe",e.Move="move",e.MoveLeft="moveLeft",e.MoveRight="moveRight",e.MoveUp="moveUp",e.MoveDown="moveDown",e.RotateCCW="rotateCCW",e.RotateCW="rotateCW",e.FlipX="flipX",e.FlipY="flipY",e.ToggleFS="toggleFS"}(p||(p={})),function(e){e.Cover="cover",e.Full="full",e.Max="max"}(v||(v={}));const b={x:0,y:0,scale:1,angle:0,flipX:1,flipY:1},y={bounds:!0,classes:{container:"f-panzoom",wrapper:"f-panzoom__wrapper",content:"f-panzoom__content",viewport:"f-panzoom__viewport"},clickAction:p.ToggleFull,dblClickAction:!1,gestures:{},height:"auto",l10n:c,maxScale:4,minScale:1,mouseMoveFactor:1,panMode:"drag",protected:!1,singleClickAction:!1,spinnerTpl:'<div class="f-spinner"></div>',wheelAction:p.Zoom,width:"auto"};let x,w=0,M=0,k=0;const E=(c,v={},E={})=>{let j,S,O,T,C,A,F,L,Z=0,P=Object.assign(Object.assign({},y),v),X={},Y=Object.assign({},b),R=Object.assign({},b);const z=[];function D(e){let t=P[e];return t&&"function"==typeof t?t(ke):t}function I(){return c&&c.parentElement&&j&&3===Z}const W=new Map;function H(e,...t){const n=[...W.get(e)||[]];P.on&&n.push(P.on[e]);for(const e of n)e&&e instanceof Function&&e(ke,...t);"*"!==e&&H("*",e,...t)}function q(e){if(!I())return;const t=e.target;if(n(t))return;const o=Date.now(),a=[-e.deltaX||0,-e.deltaY||0,-e.detail||0].reduce((function(e,t){return Math.abs(t)>Math.abs(e)?t:e})),s=i(-1,a,1);H("wheel",e,s);const r=D("wheelAction");if(!r)return;if(e.defaultPrevented)return;const l=R.scale;let c=l*(s>0?1.5:.5);if(r===p.Zoom){const t=Math.abs(e.deltaY)<100&&Math.abs(e.deltaX)<100;if(o-M<(t?200:45))return void g(e);M=o;const n=te(),a=ae();if(h(c)<h(n)&&h(l)<=h(n)?(k+=Math.abs(s),c=n):h(c)>h(a)&&h(l)>=h(a)?(k+=Math.abs(s),c=a):(k=0,c=i(n,c,a)),k>7)return}switch(g(e),r){case p.Pan:ce(r,{srcEvent:e,deltaX:2*-e.deltaX,deltaY:2*-e.deltaY});break;case p.Zoom:ce(p.ZoomTo,{srcEvent:e,scale:c,center:{x:e.clientX,y:e.clientY}});break;default:ce(r,{srcEvent:e})}}function $(e){var n,o;const i=e.composedPath()[0];if(!l.isClickAllowed())return;if(!t(i)||e.defaultPrevented)return;if(!(null==c?void 0:c.contains(i)))return;if(i.hasAttribute("disabled")||i.hasAttribute("aria-disabled"))return;const a=i.closest("[data-panzoom-action]"),s=null===(n=null==a?void 0:a.dataset)||void 0===n?void 0:n.panzoomAction,r=(null===(o=null==a?void 0:a.dataset)||void 0===o?void 0:o.panzoomValue)||"";if(s){switch(s){case p.ZoomTo:case p.ZoomIn:case p.ZoomOut:ce(s,{scale:parseFloat(r||"")||void 0});break;case p.MoveLeft:case p.MoveRight:ce(s,{deltaX:parseFloat(r||"")||void 0});break;case p.MoveUp:case p.MoveDown:ce(s,{deltaY:parseFloat(r||"")||void 0});break;case p.ToggleFS:we();break;default:ce(s)}return}if(!(null==j?void 0:j.contains(i)))return;const u={srcEvent:e};if(ce(D("clickAction"),u),D("dblClickAction")){const e=Date.now(),t=e-(w||e);w=e,t>0&&t<=250?(x&&(clearTimeout(x),x=void 0),ce(D("dblClickAction"),u)):x=setTimeout((()=>{ce(D("singleClickAction"),u)}),250)}}function _(e){if(L=e,!I()||!K())return;if(Y.scale<=1||R.scale<=1)return;if(((null==j?void 0:j.dataset.animationName)||"").indexOf("zoom")>-1)return;const t=Q(R.scale);if(!t)return;const{x:n,y:o}=t;ce(p.Pan,{deltaX:n-R.x,deltaY:o-R.y})}function B(){var e;c&&(d(c,"is-loading"),null===(e=c.querySelector(".f-spinner"))||void 0===e||e.remove())}function N(){if(!c||!S)return;if(B(),m(S)&&(!S.complete||!S.naturalWidth))return Z=2,null==j||j.classList.add("has-error"),void H("error");H("loaded");const{width:e,height:t}=G();m(S)&&(S.setAttribute("width",e+""),S.setAttribute("height",t+"")),j&&(d(j,"has-error"),m(S)&&(j.setAttribute("width",e+""),j.setAttribute("height",t+""),j.style.aspectRatio=`${e/t||""}`)),A=a().on("start",((e,t)=>{R=Object.assign(Object.assign({},b),t),void 0!==t.angle&&(t.angle=90*Math.round(t.angle/90)),void 0!==t.flipX&&(t.flipX=t.flipX>0?1:-1),void 0!==t.flipY&&(t.flipY=t.flipY>0?1:-1),le(),H("animationStart")})).on("pause",(e=>{R=Object.assign(Object.assign({},b),e)})).on("step",(e=>{if(!I())return void(null==A||A.end());if(Y=Object.assign(Object.assign({},b),e),K()||!D("bounds")||be()||R.scale>Y.scale||R.scale<ne())return void ue();const t=se(R.scale);let n=!1,o=!1,a=!1,s=!1;Y.x<t.x[0]&&(n=!0),Y.x>t.x[1]&&(o=!0),Y.y<t.y[0]&&(s=!0),Y.y>t.y[1]&&(a=!0);let r=!1,l=!1,c=!1,u=!1;R.x<t.x[0]&&(r=!0),R.x>t.x[1]&&(l=!0),R.y<t.y[0]&&(u=!0),R.y>t.y[1]&&(c=!0);let d=!1;(o&&l||n&&r)&&(R.x=i(t.x[0],R.x,t.x[1]),d=!0),(a&&c||s&&u)&&(R.y=i(t.y[0],R.y,t.y[1]),d=!0),d&&A&&A.spring({tension:94,friction:17,maxSpeed:555*R.scale,restDelta:.1,restSpeed:.1,velocity:A.getCurrentVelocities()}).from(Y).to(R).start(),ue()})).on("end",(()=>{re(),(null==A?void 0:A.isRunning())||(le(),H("animationEnd"))})),function(){const e=D("gestures");e&&T&&S&&(C=l(T,e).on("start",(e=>{if(!A)return;const t=e.srcEvent;K()||((Y.scale>1||e.currentTouch.length>1)&&(null==t||t.stopPropagation(),A.pause()),1===e.currentTouch.length&&H("touchStart"))})).on("move",(e=>{K()||(1!==R.scale||e.currentTouch.length>1)&&(e.srcEvent.preventDefault(),e.srcEvent.stopPropagation())})).on("pan",(e=>{if(!I()||K())return;const t=e.srcEvent;(1!==R.scale||e.currentTouch.length>1)&&(g(t),ce(p.Pan,e))})).on("swipe",(e=>{I()&&!K()&&R.scale>1&&ce(p.Swipe,e)})).on("tap",(e=>{H("click",e)})).on("singleTap",(e=>{H("singleClick",e)})).on("doubleTap",(e=>{H("dblClick",e)})).on("pinch",(e=>{K()||(e.scale>ne()?ce(p.ZoomIn,e):e.scale<ne()?ce(p.ZoomOut,e):ce(p.Pan,e))})).on("end",(e=>{K()||(e.currentTouch.length?(e.srcEvent.stopPropagation(),g(e.srcEvent),null==A||A.end()):(le(),re(),H("touchEnd")))})).init())}(),T&&(T.addEventListener("wheel",q,{passive:!1}),z.push((()=>{null==T||T.removeEventListener("wheel",q,{passive:!1})}))),null==c||c.addEventListener("click",$),null===document||void 0===document||document.addEventListener("mousemove",_),z.push((()=>{null==c||c.removeEventListener("click",$),null===document||void 0===document||document.removeEventListener("mousemove",_)}));const n=V();Y=Object.assign({},n),R=Object.assign({},n),Z=3,ue(),le(),H("ready"),requestAnimationFrame((()=>{B(),T&&(T.style.visibility="")}))}function V(){const e=Object.assign({},D("startPos")||{});let t=e.scale,n=1;n="string"==typeof t?ee(t):"number"==typeof t?t:ne();const o=Object.assign(Object.assign(Object.assign({},b),e),{scale:n}),i=K()?Q(n):void 0;if(i){const{x:e,y:t}=i;o.x=e,o.y=t}return o}function U(){const e={top:0,left:0,width:0,height:0};if(j){const t=j.getBoundingClientRect();R.angle%180==90?(e.top=t.top+.5*t.height-.5*t.width,e.left=t.left+.5*t.width-.5*t.height,e.width=t.height,e.height=t.width):(e.top=t.top,e.left=t.left,e.width=t.width,e.height=t.height)}return e}function G(){let t=D("width"),n=D("height");if(S&&"auto"===t){const e=S.getAttribute("width");t=e?parseFloat(e+""):void 0!==S.dataset.width?parseFloat(S.dataset.width+""):m(T)?T.naturalWidth:m(S)?S.naturalWidth:S.getBoundingClientRect().width}else t=e(t)?parseFloat(t):t;if(S&&"auto"===n){const e=S.getAttribute("height");n=e?parseFloat(e+""):void 0!==S.dataset.height?parseFloat(S.dataset.height+""):m(T)?T.naturalHeight:m(S)?S.naturalHeight:S.getBoundingClientRect().height}else n=e(n)?parseFloat(n):n;return{width:t,height:n}}function J(){const e=U();return{width:e.width,height:e.height}}function K(){return"mousemove"===D("panMode")&&matchMedia("(hover: hover)").matches}function Q(e){const t=L||D("event"),n=null==j?void 0:j.getBoundingClientRect();if(!t||!n||e<=1)return{x:0,y:0};const o=(t.clientX||0)-n.left,a=(t.clientY||0)-n.top,{width:s,height:r}=J(),l=se(e);if(e>1){const t=D("mouseMoveFactor");t>1&&(e*=t)}let c=s*e,u=r*e,d=.5*(c-s)-o/s*100/100*(c-s),f=.5*(u-r)-a/r*100/100*(u-r);return d=i(l.x[0],d,l.x[1]),f=i(l.y[0],f,l.y[1]),{x:d,y:f}}function ee(e="base"){if(!c)return 1;const t=c.getBoundingClientRect(),n=U(),{width:o,height:a}=G(),s=e=>{if("number"==typeof e)return e;switch(e){case"min":case"base":return 1;case"cover":return Math.max(t.height/n.height,t.width/n.width)||1;case"full":case"max":{const e=R.angle%180==90?a:o;return e&&n.width?e/n.width:1}}},r=D("minScale"),l=D("maxScale"),u=Math.min(s("full"),s(r)),d="number"==typeof l?s("full")*l:Math.min(s("full"),s(l));switch(e){case"min":return u;case"base":return i(u,1,d);case"cover":return s("cover");case"full":return Math.min(d,s("full"));case"max":return d}}function te(){return ee("min")}function ne(){return ee("base")}function oe(){return ee("cover")}function ie(){return ee("full")}function ae(){return ee("max")}function se(e){const t={x:[0,0],y:[0,0]},n=null==c?void 0:c.getBoundingClientRect();if(!n)return t;const o=U(),i=n.width,a=n.height;let s=o.width,r=o.height,l=e=void 0===e?R.scale:e,u=e;if(K()&&e>1){const t=D("mouseMoveFactor");t>1&&(s*e>i+.01&&(l*=t),r*e>a+.01&&(u*=t))}return s*=l,r*=u,e>1&&(s>i&&(t.x[0]=.5*(i-s),t.x[1]=.5*(s-i)),t.x[0]-=.5*(o.left-n.left),t.x[1]-=.5*(o.left-n.left),t.x[0]-=.5*(o.left+o.width-n.right),t.x[1]-=.5*(o.left+o.width-n.right),r>a&&(t.y[0]=.5*(a-r),t.y[1]=.5*(r-a)),t.y[0]-=.5*(o.top-n.top),t.y[1]-=.5*(o.top-n.top),t.y[0]-=.5*(o.top+o.height-n.bottom),t.y[1]-=.5*(o.top+o.height-n.bottom)),t}function re(){if(!I())return;if(!D("bounds"))return;if(!A)return;const e=te(),t=ae(),n=i(e,R.scale,t);if(R.scale<e-.01||R.scale>t+.01)return void ce(p.ZoomTo,{scale:n});if(A.isRunning())return;if(be())return;const o=se(n);R.x<o.x[0]||R.x>o.x[1]||R.y<o.y[0]||R.y>o.y[1]?(R.x=i(o.x[0],R.x,o.x[1]),R.y=i(o.y[0],R.y,o.y[1]),A.spring({tension:170,friction:17,restDelta:.001,restSpeed:.001,maxSpeed:1/0,velocity:A.getCurrentVelocities()}),A.from(Y).to(R).start()):ue()}function le(){if(!I())return;const e=ve(),t=be(),n=ye(),o=xe(),i=fe(),a=ge();f(j,"is-fullsize",o),f(j,"is-expanded",n),f(j,"is-dragging",t),f(j,"can-drag",e),f(j,"will-zoom-in",i),f(j,"will-zoom-out",a);const s=me(),r=pe(),l=he(),u=!I();for(const e of(null==c?void 0:c.querySelectorAll("[data-panzoom-action]"))||[]){const t=e.dataset.panzoomAction;let n=!1;if(u)n=!0;else switch(t){case p.ZoomIn:s||(n=!0);break;case p.ZoomOut:l||(n=!0);break;case p.ToggleFull:r||l||(n=!0);const t=e.querySelector("g");t&&(t.style.display=o&&!n?"none":"");break;case p.ToggleCover:case p.ToggleMax:s||l||(n=!0)}n?(e.setAttribute("aria-disabled",""),e.setAttribute("tabindex","-1")):(e.removeAttribute("aria-disabled"),e.removeAttribute("tabindex"))}}function ce(e,t){var n;if(!c||!S||!A)return;if(e===p.Swipe&&Math.abs(A.getCurrentVelocities().scale)>.01)return;let o=Object.assign({},R),a=se(K()?R.scale:Y.scale);const l=A.getCurrentVelocities(),u=U(),d=((null===(n=(t=t||{}).currentTouch)||void 0===n?void 0:n.length)||0)>1,f=t.velocityX||0,g=t.velocityY||0;let h=t.center;!h&&t.srcEvent&&(h=s(r(t.srcEvent)));let m=t.deltaX||0,v=t.deltaY||0;switch(e){case p.MoveRight:m=t.deltaX||100;break;case p.MoveLeft:m=t.deltaX||-100;break;case p.MoveUp:v=t.deltaY||-100;break;case p.MoveDown:v=t.deltaY||100}let y=[];switch(e){case p.Reset:R=Object.assign({},b),R.scale=ne();break;case p.Pan:case p.Move:case p.MoveLeft:case p.MoveRight:case p.MoveUp:case p.MoveDown:if(be()){let e=1,t=1;R.x<=a.x[0]&&f<=0&&(e=Math.max(.01,1-Math.abs(1/u.width*Math.abs(R.x-a.x[0]))),e*=.2),R.x>=a.x[1]&&f>=0&&(e=Math.max(.01,1-Math.abs(1/u.width*Math.abs(R.x-a.x[1]))),e*=.2),R.y<=a.y[0]&&g<=0&&(t=Math.max(.01,1-Math.abs(1/u.height*Math.abs(R.y-a.y[0]))),t*=.2),R.y>=a.y[1]&&g>=0&&(t=Math.max(.01,1-Math.abs(1/u.height*Math.abs(R.y-a.y[1]))),t*=.2),R.x+=m*e,R.y+=v*t}else R.x=i(a.x[0],R.x+m,a.x[1]),R.y=i(a.y[0],R.y+v,a.y[1]);break;case p.Swipe:const e=(e=0)=>Math.sign(e)*Math.pow(Math.abs(e),1.5);R.x+=i(-1e3,e(f),1e3),R.y+=i(-1e3,e(g),1e3),g&&!f&&(R.x=i(a.x[0],R.x,a.x[1])),!g&&f&&(R.y=i(a.y[0],R.y,a.y[1])),l.x=f,l.y=g;break;case p.ZoomTo:R.scale=t.scale||1;break;case p.ZoomIn:R.scale=R.scale*(t.scale||2),d||(R.scale=Math.min(R.scale,ae()));break;case p.ZoomOut:R.scale=R.scale*(t.scale||.5),d||(R.scale=Math.max(R.scale,te()));break;case p.ToggleCover:y=[ne(),oe()];break;case p.ToggleFull:y=[ne(),ie()];break;case p.ToggleMax:y=[ne(),ae()];break;case p.IterateZoom:y=[ne(),ie(),ae()];break;case p.Zoom:const n=ie();R.scale>=n-.05?R.scale=ne():R.scale=Math.min(n,R.scale*(t.scale||2));break;case p.RotateCW:R.angle+=90;break;case p.RotateCCW:R.angle-=90;break;case p.FlipX:R.flipX*=-1;break;case p.FlipY:R.flipY*=-1}if(void 0!==Y.angle&&Math.abs(Y.angle)>=360&&(R.angle-=360*Math.floor(Y.angle/360),Y.angle-=360*Math.floor(Y.angle/360)),y.length){const e=y.findIndex((e=>e>R.scale+1e-4));R.scale=y[e]||y[0]}if(d&&(R.scale=i(te()*(d?.8:1),R.scale,ae()*(d?1.6:1))),K()){const e=Q(R.scale);if(e){const{x:t,y:n}=e;R.x=t,R.y=n}}else if(R.scale!==o.scale){let e=0,t=0;if(h)e=h.x,t=h.y;else{const n=c.getBoundingClientRect();e=n.x+.5*n.width,t=n.y+.5*n.height}let n=e-u.left,s=t-u.top;n-=.5*u.width,s-=.5*u.height;const r=(n-o.x)/o.scale,l=(s-o.y)/o.scale;R.x=n-r*R.scale,R.y=s-l*R.scale,!d&&D("bounds")&&(a=se(),R.x=i(a.x[0],R.x,a.x[1]),R.y=i(a.y[0],R.y,a.y[1]))}if(e===p.Swipe){let e=94,t=17,n=500*R.scale,o=l;A.spring({tension:e,friction:t,maxSpeed:n,restDelta:.1,restSpeed:.1,velocity:o})}else e===p.Pan||d?A.spring({tension:900,friction:17,restDelta:.01,restSpeed:.01,maxSpeed:1}):A.spring({tension:170,friction:17,restDelta:.001,restSpeed:.001,maxSpeed:1/0,velocity:l});0===t.velocity?(Y=Object.assign({},R),ue()):A.from(Y).to(R).start(),H("action",e)}function ue(){if(!S||!j||!T)return;const{width:e,height:t}=G();Object.assign(j.style,{maxWidth:`min(${e}px, 100%)`,maxHeight:`min(${t}px, 100%)`});const n=function(){const{width:e,height:t}=G(),{width:n,height:o}=J();if(!c)return{x:0,y:0,width:0,height:0,scale:0,flipX:0,flipY:0,angle:0,fitWidth:n,fitHeight:o,fullWidth:e,fullHeight:t};let{x:i,y:a,scale:s,angle:r,flipX:l,flipY:u}=Y,d=1/ie(),f=e,g=t,h=Y.scale*d,m=R.scale*d;const p=Math.max(n,o),v=Math.min(n,o);e>t?(f=p,g=v):(f=v,g=p);h=e>t?p*s/e||1:p*s/t||1;let b=f?e*m:0,y=g?t*m:0,x=f&&g?e*h/b:0;return i=i+.5*f-.5*b,a=a+.5*g-.5*y,{x:i,y:a,width:b,height:y,scale:x,flipX:l,flipY:u,angle:r,fitWidth:n,fitHeight:o,fullWidth:e,fullHeight:t}}(),{x:o,y:i,width:a,height:s,scale:r,angle:l,flipX:u,flipY:d}=n;let f=`translate(${h(o)}px, ${h(i)}px)`;f+=1!==u||1!==d?` scaleX(${h(r*u)}) scaleY(${h(r*d)})`:` scale(${h(r)})`,0!==l&&(f+=` rotate(${l}deg)`),T.style.width=`${h(a)}px`,T.style.height=`${h(s)}px`,T.style.transform=`${f}`,H("render")}function de(){let e=R.scale;const t=D("clickAction");let n=ne();if(t){let o=[];switch(t){case p.ZoomIn:n=2*e;break;case p.ZoomOut:n=.5*e;break;case p.ToggleCover:o=[ne(),oe()];break;case p.ToggleFull:o=[ne(),ie()];break;case p.ToggleMax:o=[ne(),ae()];break;case p.IterateZoom:o=[ne(),ie(),ae()];break;case p.Zoom:const t=ie();n=e>=t-.05?ne():Math.min(t,2*e)}if(o.length){const t=o.findIndex((t=>t>e+1e-4));n=o[t]||ne()}}return n=i(te(),n,ae()),n}function fe(){return!!(I()&&de()>R.scale)}function ge(){return!!(I()&&de()<R.scale)}function he(){return!!(I()&&R.scale>te())}function me(){return!!(I()&&R.scale<ae())}function pe(){return!!(I()&&R.scale<ie())}function ve(){return!(!(I()&&ye()&&C)||K())}function be(){return!(!I()||!(null==C?void 0:C.isPointerDown())||K())}function ye(){return!!(I()&&R.scale>ne())}function xe(){return!!(I()&&R.scale>=ie())}function we(){const e="in-fullscreen",t="with-panzoom-in-fullscreen";null==c||c.classList.toggle(e);const n=null==c?void 0:c.classList.contains(e);n?(document.documentElement.classList.add(t),document.addEventListener("keydown",Me,!0)):(document.documentElement.classList.remove(t),document.removeEventListener("keydown",Me,!0)),ue(),H(n?"enterFS":"exitFS")}function Me(e){"Escape"!==e.key||e.defaultPrevented||we()}const ke={canDrag:ve,canZoomIn:me,canZoomOut:he,canZoomToFull:pe,destroy:function(){H("destroy");for(const e of Object.values(X))null==e||e.destroy(ke);for(const e of z)e();return j&&(j.style.aspectRatio="",j.style.maxWidth="",j.style.maxHeight=""),T&&(T.style.width="",T.style.height="",T.style.transform=""),j=void 0,S=void 0,T=void 0,Y=Object.assign({},b),R=Object.assign({},b),null==A||A.destroy(),A=void 0,null==C||C.destroy(),C=void 0,Z=4,ke},emit:H,execute:ce,getBoundaries:se,getContainer:function(){return c},getContent:function(){return S},getFullDim:G,getGestures:function(){return C},getMousemovePos:Q,getOptions:function(){return P},getPlugins:function(){return X},getScale:ee,getStartPosition:V,getState:function(){return Z},getTransform:function(e){return!0===e?R:Y},getTween:function(){return A},getViewport:function(){return T},getWrapper:function(){return j},init:function(){return Z=0,H("init"),function(){for(const[e,t]of Object.entries(Object.assign(Object.assign({},E),P.plugins||{})))if(e&&!X[e]&&t instanceof Function){const n=t();n.init(ke),X[e]=n}H("initPlugins")}(),function(){const e=Object.assign(Object.assign({},y.classes),D("classes"));if(!c)return;if(u(c,e.container),S=c.querySelector("."+e.content),!S)return;S.setAttribute("draggable","false"),j=c.querySelector("."+e.wrapper),j||(j=document.createElement("div"),u(j,e.wrapper),S.insertAdjacentElement("beforebegin",j),j.insertAdjacentElement("afterbegin",S));T=c.querySelector("."+e.viewport),T||(T=document.createElement("div"),u(T,e.viewport),T.insertAdjacentElement("afterbegin",S),j.insertAdjacentElement("beforeend",T));O=S.cloneNode(!0),O.removeAttribute("id"),j.insertAdjacentElement("afterbegin",O),S instanceof HTMLPictureElement&&(S=S.querySelector("img"));O instanceof HTMLPictureElement&&(O=O.querySelector("img"));T instanceof HTMLPictureElement&&(T=T.querySelector("img"));if(T&&(T.style.visibility="hidden",D("protected"))){T.addEventListener("contextmenu",(e=>{e.preventDefault()}));const e=document.createElement("div");u(e,"f-panzoom__protected"),T.appendChild(e)}H("initLayout")}(),function(){if(c&&j&&!F){let e=null;F=new ResizeObserver((()=>{I()&&(e=e||requestAnimationFrame((()=>{I()&&(le(),re(),H("refresh")),e=null})))})),F.observe(j),z.push((()=>{null==F||F.disconnect(),F=void 0,e&&(cancelAnimationFrame(e),e=null)}))}}(),function(){if(!c||!S)return;if(!m(S)||!m(O))return void N();const e=()=>{S&&m(S)&&S.decode().then((()=>{N()})).catch((()=>{N()}))};if(Z=1,c.classList.add("is-loading"),H("loading"),O.src&&O.complete)return void e();(function(){if(!c)return;if(null==c?void 0:c.querySelector(".f-spinner"))return;const e=D("spinnerTpl"),t=o(e);t&&(t.classList.add("f-spinner"),c.classList.add("is-loading"),null==j||j.insertAdjacentElement("afterbegin",t))})(),O.addEventListener("load",e,!1),O.addEventListener("error",e,!1),z.push((()=>{null==O||O.removeEventListener("load",e,!1),null==O||O.removeEventListener("error",e,!1)}))}(),ke},isDragging:be,isExpanded:ye,isFullsize:xe,localize:function(e,t=[]){const n=D("l10n")||{};e=String(e).replace(/\{\{(\w+)\}\}/g,((e,t)=>n[t]||e));for(let n=0;n<t.length;n++)e=e.split(t[n][0]).join(t[n][1]);return e=e.replace(/\{\{(.*?)\}\}/g,((e,t)=>t))},off:function(e,t){for(const n of e instanceof Array?e:[e])W.has(n)&&W.set(n,W.get(n).filter((e=>e!==t)));return ke},on:function(e,t){for(const n of e instanceof Array?e:[e])W.set(n,[...W.get(n)||[],t]);return ke},toggleFS:we,version:"6.0.30",willZoomIn:fe,willZoomOut:ge};return ke};E.l10n={en_EN:c},E.getDefaults=()=>y;export{b as PANZOOM_DEFAULT_POS,E as Panzoom,p as PanzoomAction,v as PanzoomZoomLevel};
