/*! License details at fancyapps.com/license */
import{isString as e}from"../utils/isString.js";import{isNode as t}from"../utils/isNode.js";import{getScrollableParent as n}from"../utils/getScrollableParent.js";import{stringToHtml as i}from"../utils/strToHtml.js";import{clamp as o}from"../utils/clamp.js";import{Tween as a}from"../libs/tween.js";import{getMidpoint as s,getChangedPosition as l,Gestures as r}from"../libs/gestures.js";import{en_EN as c}from"./l10n/en_EN.js";import{addClass as u}from"../utils/addClass.js";import{removeClass as f}from"../utils/removeClass.js";const d=e=>{e.cancelable&&e.preventDefault()},g=(e,t=1e4)=>(e=parseFloat(e+"")||0,Math.round((e+Number.EPSILON)*t)/t);var h,m;!function(e){e.Reset="reset",e.Zoom="zoom",e.ZoomIn="zoomIn",e.ZoomOut="zoomOut",e.ZoomTo="zoomTo",e.ToggleCover="toggleCover",e.ToggleFull="toggleFull",e.ToggleMax="toggleMax",e.IterateZoom="iterateZoom",e.Pan="pan",e.Swipe="swipe",e.Move="move",e.MoveLeft="moveLeft",e.MoveRight="moveRight",e.MoveUp="moveUp",e.MoveDown="moveDown",e.RotateCCW="rotateCCW",e.RotateCW="rotateCW",e.FlipX="flipX",e.FlipY="flipY"}(h||(h={})),function(e){e.Cover="cover",e.Full="full",e.Max="max"}(m||(m={}));const p={x:0,y:0,scale:1,angle:0,flipX:1,flipY:1},v={bounds:!0,classes:{container:"f-panzoom",wrapper:"f-panzoom__wrapper",content:"f-panzoom__content",viewport:"f-panzoom__viewport"},clickAction:h.ToggleFull,dblClickAction:!1,gestures:{},height:"auto",l10n:c,maxScale:4,minScale:1,mouseMoveFactor:1,panMode:"drag",protected:!1,singleClickAction:!1,spinnerTpl:'<div class="f-spinner"></div>',wheelAction:h.Zoom,width:"auto"};let b,y=0,x=0,w=0;const M=(c,m={},M={})=>{let E,k,T,j,A,O,L,C=0,S=Object.assign(Object.assign({},v),m),F={},Z=Object.assign({},p),X=Object.assign({},p);const Y=[];function I(e){let t=S[e];return t&&"function"==typeof t?t(me):t}const P=new Map;function R(e,...t){const n=[...P.get(e)||[]];S.on&&n.push(S.on[e]);for(const e of n)e&&e instanceof Function&&e(me,...t);"*"!==e&&R("*",e,...t)}function D(e){if(3!==C)return;const t=e.target;if(n(t))return;const i=Date.now(),a=[-e.deltaX||0,-e.deltaY||0,-e.detail||0].reduce((function(e,t){return Math.abs(t)>Math.abs(e)?t:e})),s=o(-1,a,1);R("wheel",e,s);const l=I("wheelAction");if(!l)return;if(e.defaultPrevented)return;const r=X.scale;let c=r*(s>0?1.5:.5);if(l===h.Zoom){const t=Math.abs(e.deltaY)<100&&Math.abs(e.deltaX)<100;if(i-x<(t?200:45))return void d(e);x=i;const n=G(),a=ee();if(g(c)<g(n)&&g(r)<=g(n)?(w+=Math.abs(s),c=n):g(c)>g(a)&&g(r)>=g(a)?(w+=Math.abs(s),c=a):(w=0,c=o(n,c,a)),w>7)return}switch(d(e),l){case h.Pan:oe(l,{srcEvent:e,deltaX:2*-e.deltaX,deltaY:2*-e.deltaY});break;case h.Zoom:oe(h.ZoomTo,{srcEvent:e,scale:c,center:{x:e.clientX,y:e.clientY}});break;default:oe(l,{srcEvent:e})}}function z(e){var n,i;const o=e.composedPath()[0];if(!r.isClickAllowed())return;if(!t(o)||e.defaultPrevented)return;if(!(null==c?void 0:c.contains(o)))return;if(o.hasAttribute("disabled")||o.hasAttribute("aria-disabled"))return;const a=o.closest("[data-panzoom-action]"),s=null===(n=null==a?void 0:a.dataset)||void 0===n?void 0:n.panzoomAction,l=(null===(i=null==a?void 0:a.dataset)||void 0===i?void 0:i.panzoomValue)||"";if(s){switch(s){case h.ZoomTo:case h.ZoomIn:case h.ZoomOut:oe(s,{scale:parseFloat(l||"")||void 0});break;case h.MoveLeft:case h.MoveRight:oe(s,{deltaX:parseFloat(l||"")||void 0});break;case h.MoveUp:case h.MoveDown:oe(s,{deltaY:parseFloat(l||"")||void 0});break;default:oe(s)}return}if(!(null==E?void 0:E.contains(o)))return;const u={srcEvent:e};if(oe(I("clickAction"),u),I("dblClickAction")){const e=Date.now(),t=e-(y||e);y=e,t>0&&t<=250?(b&&(clearTimeout(b),b=void 0),oe(I("dblClickAction"),u)):b=setTimeout((()=>{oe(I("singleClickAction"),u)}),250)}}function H(e){if(L=e,!N())return;if(3!==C||Z.scale<=1||X.scale<=1)return;if(((null==E?void 0:E.dataset.animationName)||"").indexOf("zoom")>-1)return;const t=V(X.scale);if(!t)return;const{x:n,y:i}=t;oe(h.Pan,{deltaX:n-X.x,deltaY:i-X.y})}function W(){var e;c&&(f(c,"is-loading"),null===(e=c.querySelector(".f-spinner"))||void 0===e||e.remove())}function q(){if(!c||!k)return;if(k instanceof HTMLImageElement&&(!k.complete||!k.naturalWidth))return W(),C=2,null==E||E.classList.add("has-error"),void R("error");R("loaded");const{width:e,height:t}=_();k instanceof HTMLImageElement&&(k.setAttribute("width",e+""),k.setAttribute("height",t+"")),E&&(f(E,"has-error"),E.setAttribute("width",e+""),E.setAttribute("height",t+""),E.style.aspectRatio=`${e/t||""}`),A=a().on("start",((e,t)=>{X=Object.assign(Object.assign({},p),t),void 0!==t.angle&&(t.angle=90*Math.round(t.angle/90)),void 0!==t.flipX&&(t.flipX=t.flipX>0?1:-1),void 0!==t.flipY&&(t.flipY=t.flipY>0?1:-1),ie(),R("animationStart")})).on("pause",(e=>{X=Object.assign(Object.assign({},p),e)})).on("step",(e=>{if(3!==C)return;if(!A)return;if(!c||!c.parentElement)return void A.end();if(Z=Object.assign(Object.assign({},p),e),N()||!I("bounds")||(null==j?void 0:j.isPointerDown())||X.scale>Z.scale||X.scale<J())return void ae();const t=te(X.scale);let n=!1,i=!1,a=!1,s=!1;Z.x<t.x[0]&&(n=!0),Z.x>t.x[1]&&(i=!0),Z.y<t.y[0]&&(s=!0),Z.y>t.y[1]&&(a=!0);let l=!1,r=!1,u=!1,f=!1;X.x<t.x[0]&&(l=!0),X.x>t.x[1]&&(r=!0),X.y<t.y[0]&&(f=!0),X.y>t.y[1]&&(u=!0);let d=!1;(i&&r||n&&l)&&(X.x=o(t.x[0],X.x,t.x[1]),d=!0),(a&&u||s&&f)&&(X.y=o(t.y[0],X.y,t.y[1]),d=!0),d&&A.spring({tension:94,friction:17,maxSpeed:555*X.scale,restDelta:.1,restSpeed:.1,velocity:A.getCurrentVelocities()}).from(Z).to(X).start(),ae()})).on("end",(()=>{ne(),(null==A?void 0:A.isRunning())||(ie(),R("animationEnd"))})),function(){const e=I("gestures");e&&T&&k&&(j=r(T,e).on("start",(e=>{if(!A)return;const t=e.srcEvent;N()||((Z.scale>1||e.currentTouch.length>1)&&(null==t||t.stopPropagation(),A.pause()),1===e.currentTouch.length&&R("touchStart"))})).on("move",(e=>{N()||(1!==X.scale||e.currentTouch.length>1)&&(e.srcEvent.preventDefault(),e.srcEvent.stopPropagation())})).on("pan",(e=>{if(N())return;const t=e.srcEvent;(1!==X.scale||e.currentTouch.length>1)&&(d(t),oe(h.Pan,e))})).on("swipe",(e=>{N()||X.scale>1&&oe(h.Swipe,e)})).on("tap",(e=>{R("click",e)})).on("singleTap",(e=>{R("singleClick",e)})).on("doubleTap",(e=>{R("dblClick",e)})).on("pinch",(e=>{N()||(e.scale>J()?oe(h.ZoomIn,e):e.scale<J()?oe(h.ZoomOut,e):oe(h.Pan,e))})).on("end",(e=>{N()||(e.currentTouch.length?(e.srcEvent.stopPropagation(),d(e.srcEvent),null==A||A.end()):(ie(),ne(),R("touchEnd")))})).init())}(),T&&(T.addEventListener("wheel",D,{passive:!1}),Y.push((()=>{null==T||T.removeEventListener("wheel",D,{passive:!1})}))),null==c||c.addEventListener("click",z),null===document||void 0===document||document.addEventListener("mousemove",H),Y.push((()=>{null==c||c.removeEventListener("click",z),null===document||void 0===document||document.removeEventListener("mousemove",H)}));const n=Object.assign(Object.assign({},I("startPos")||{}),{scale:J()});if(Z=Object.assign(Object.assign({},p),n),X=Object.assign(Object.assign({},p),n),N()){const e=V(X.scale);if(e){const{x:t,y:n}=e;Z.x=t,Z.y=n,X.x=t,X.y=n}}C=3,ae(),ie(),R("ready"),requestAnimationFrame((()=>{W(),T&&(T.style.visibility=""),function(){if(c&&E&&!O){let e=null;O=new ResizeObserver((()=>{e||(e=requestAnimationFrame((()=>{c&&c.parentElement&&3===C&&(ie(),ne(),R("refresh")),e=null})))})),O.observe(E),Y.push((()=>{null==O||O.disconnect(),O=void 0,e&&(cancelAnimationFrame(e),e=null)}))}}()}))}function $(){const e={top:0,left:0,width:0,height:0};if(E){const t=E.getBoundingClientRect();X.angle%180==90?(e.top=t.top+.5*t.height-.5*t.width,e.left=t.left+.5*t.width-.5*t.height,e.width=t.height,e.height=t.width):(e.top=t.top,e.left=t.left,e.width=t.width,e.height=t.height)}return e}function _(){let t=I("width"),n=I("height");if(k&&"auto"===t){const e=k.getAttribute("width");t=e?parseFloat(e+""):void 0!==k.dataset.width?parseFloat(k.dataset.width+""):T instanceof HTMLImageElement?T.naturalWidth:k instanceof HTMLImageElement?k.naturalWidth:k.getBoundingClientRect().width}else t=e(t)?parseFloat(t):t;if(k&&"auto"===n){const e=k.getAttribute("height");n=e?parseFloat(e+""):void 0!==k.dataset.height?parseFloat(k.dataset.height+""):T instanceof HTMLImageElement?T.naturalHeight:k instanceof HTMLImageElement?k.naturalHeight:k.getBoundingClientRect().height}else n=e(n)?parseFloat(n):n;return{width:t,height:n}}function B(){const e=$();return{width:e.width,height:e.height}}function N(){return"mousemove"===I("panMode")&&matchMedia("(hover: hover)").matches}function V(e){const t=L||I("event"),n=null==E?void 0:E.getBoundingClientRect();if(!t||!n||e<=1)return{x:0,y:0};const i=(t.clientX||0)-n.left,a=(t.clientY||0)-n.top,{width:s,height:l}=B(),r=te(e);if(e>1){const t=I("mouseMoveFactor");t>1&&(e*=t)}let c=s*e,u=l*e,f=.5*(c-s)-i/s*100/100*(c-s),d=.5*(u-l)-a/l*100/100*(u-l);return f=o(r.x[0],f,r.x[1]),d=o(r.y[0],d,r.y[1]),{x:f,y:d}}function U(e="base"){if(!c)return 1;const t=c.getBoundingClientRect(),n=$(),{width:i,height:a}=_(),s=e=>{if("number"==typeof e)return e;switch(e){case"min":case"base":return 1;case"cover":return Math.max(t.height/n.height,t.width/n.width)||1;case"full":case"max":{const e=X.angle%180==90?a:i;return e&&n.width?e/n.width:1}}},l=I("minScale"),r=I("maxScale"),u=Math.min(s("full"),s(l)),f="number"==typeof r?s("full")*r:Math.min(s("full"),s(r));switch(e){case"min":return u;case"base":return o(u,1,f);case"cover":return s("cover");case"full":return Math.min(f,s("full"));case"max":return f}}function G(){return U("min")}function J(){return U("base")}function K(){return U("cover")}function Q(){return U("full")}function ee(){return U("max")}function te(e){const t={x:[0,0],y:[0,0]},n=null==c?void 0:c.getBoundingClientRect();if(!n)return t;const i=$(),o=n.width,a=n.height;let s=i.width,l=i.height,r=e=void 0===e?X.scale:e,u=e;if(N()&&e>1){const t=I("mouseMoveFactor");t>1&&(s*e>o+.01&&(r*=t),l*e>a+.01&&(u*=t))}return s*=r,l*=u,e>1&&(s>o&&(t.x[0]=.5*(o-s),t.x[1]=.5*(s-o)),t.x[0]-=.5*(i.left-n.left),t.x[1]-=.5*(i.left-n.left),t.x[0]-=.5*(i.left+i.width-n.right),t.x[1]-=.5*(i.left+i.width-n.right),l>a&&(t.y[0]=.5*(a-l),t.y[1]=.5*(l-a)),t.y[0]-=.5*(i.top-n.top),t.y[1]-=.5*(i.top-n.top),t.y[0]-=.5*(i.top+i.height-n.bottom),t.y[1]-=.5*(i.top+i.height-n.bottom)),t}function ne(){if(!I("bounds"))return;if(3!==C)return;if(!(null==c?void 0:c.parentElement))return;if(!A)return;const e=G(),t=ee(),n=o(e,X.scale,t);if(X.scale<e-.01||X.scale>t+.01)return void oe(h.ZoomTo,{scale:n});if(A.isRunning())return;if(null==j?void 0:j.isPointerDown())return;const i=te(n);X.x<i.x[0]||X.x>i.x[1]||X.y<i.y[0]||X.y>i.y[1]?(X.x=o(i.x[0],X.x,i.x[1]),X.y=o(i.y[0],X.y,i.y[1]),A.spring({tension:170,friction:17,restDelta:.001,restSpeed:.001,maxSpeed:1/0,velocity:A.getCurrentVelocities()}),A.from(Z).to(X).start()):ae()}function ie(){if(!c||!c.parentElement||!E)return;const e=fe(),t=de(),n=ge(),i=he(),o=le(),a=re();E.classList.toggle("is-fullsize",i),E.classList.toggle("is-expanded",n),E.classList.toggle("is-dragging",t),E.classList.toggle("can-drag",e),E.classList.toggle("will-zoom-in",o),E.classList.toggle("will-zoom-out",a);const s=ce(),l=ue(),r=3!==C;for(const e of(null==c?void 0:c.querySelectorAll("[data-panzoom-action]"))||[]){const t=e.dataset.panzoomAction;let n=!1;if(r)n=!0;else switch(t){case h.ZoomIn:s||(n=!0);break;case h.ZoomOut:l||(n=!0);break;case h.ToggleFull:s||l||(n=!0);const t=e.querySelector("g");t&&(t.style.display=i?"none":"");break;case h.ToggleCover:case h.ToggleMax:s||l||(n=!0)}n?(e.setAttribute("aria-disabled",""),e.setAttribute("tabindex","-1")):(e.removeAttribute("aria-disabled"),e.removeAttribute("tabindex"))}}function oe(e,t){var n;if(!c||!k||!A)return;if(e===h.Swipe&&Math.abs(A.getCurrentVelocities().scale)>.01)return;let i=Object.assign({},X),a=te(N()?X.scale:Z.scale);const r=A.getCurrentVelocities(),u=$(),f=((null===(n=(t=t||{}).currentTouch)||void 0===n?void 0:n.length)||0)>1,d=t.velocityX||0,g=t.velocityY||0;let m=t.center;!m&&t.srcEvent&&(m=s(l(t.srcEvent)));let v=t.deltaX||0,b=t.deltaY||0;switch(e){case h.MoveRight:v=t.deltaX||100;break;case h.MoveLeft:v=t.deltaX||-100;break;case h.MoveUp:b=t.deltaY||-100;break;case h.MoveDown:b=t.deltaY||100}let y=[];switch(e){case h.Reset:X=Object.assign({},p),X.scale=J();break;case h.Pan:case h.Move:case h.MoveLeft:case h.MoveRight:case h.MoveUp:case h.MoveDown:if(null==j?void 0:j.isPointerDown()){let e=1,t=1;X.x<=a.x[0]&&d<=0&&(e=Math.max(.01,1-Math.abs(1/u.width*Math.abs(X.x-a.x[0]))),e*=.2),X.x>=a.x[1]&&d>=0&&(e=Math.max(.01,1-Math.abs(1/u.width*Math.abs(X.x-a.x[1]))),e*=.2),X.y<=a.y[0]&&g<=0&&(t=Math.max(.01,1-Math.abs(1/u.height*Math.abs(X.y-a.y[0]))),t*=.2),X.y>=a.y[1]&&g>=0&&(t=Math.max(.01,1-Math.abs(1/u.height*Math.abs(X.y-a.y[1]))),t*=.2),X.x+=v*e,X.y+=b*t}else X.x=o(a.x[0],X.x+v,a.x[1]),X.y=o(a.y[0],X.y+b,a.y[1]);break;case h.Swipe:const e=(e=0)=>Math.sign(e)*Math.pow(Math.abs(e),1.5);X.x+=o(-1e3,e(d),1e3),X.y+=o(-1e3,e(g),1e3),g&&!d&&(X.x=o(a.x[0],X.x,a.x[1])),!g&&d&&(X.y=o(a.y[0],X.y,a.y[1])),r.x=d,r.y=g;break;case h.ZoomTo:X.scale=t.scale||1;break;case h.ZoomIn:X.scale=X.scale*(t.scale||2),f||(X.scale=Math.min(X.scale,ee()));break;case h.ZoomOut:X.scale=X.scale*(t.scale||.5),f||(X.scale=Math.max(X.scale,G()));break;case h.ToggleCover:y=[J(),K()];break;case h.ToggleFull:y=[J(),Q()];break;case h.ToggleMax:y=[J(),ee()];break;case h.IterateZoom:y=[J(),Q(),ee()];break;case h.Zoom:const n=Q();X.scale>=n-.05?X.scale=J():X.scale=Math.min(n,X.scale*(t.scale||2));break;case h.RotateCW:X.angle+=90;break;case h.RotateCCW:X.angle-=90;break;case h.FlipX:X.flipX*=-1;break;case h.FlipY:X.flipY*=-1}if(void 0!==Z.angle&&Math.abs(Z.angle)>=360&&(X.angle-=360*Math.floor(Z.angle/360),Z.angle-=360*Math.floor(Z.angle/360)),y.length){const e=y.findIndex((e=>e>X.scale+1e-4));X.scale=y[e]||y[0]}if(f&&(X.scale=o(G()*(f?.8:1),X.scale,ee()*(f?1.6:1))),N()){const e=V(X.scale);if(e){const{x:t,y:n}=e;X.x=t,X.y=n}}else if(X.scale!==i.scale){let e=0,t=0;if(m)e=m.x,t=m.y;else{const n=c.getBoundingClientRect();e=n.x+.5*n.width,t=n.y+.5*n.height}let n=e-u.left,s=t-u.top;n-=.5*u.width,s-=.5*u.height;const l=(n-i.x)/i.scale,r=(s-i.y)/i.scale;X.x=n-l*X.scale,X.y=s-r*X.scale,!f&&I("bounds")&&(a=te(X.scale),X.x=o(a.x[0],X.x,a.x[1]),X.y=o(a.y[0],X.y,a.y[1]))}if(e===h.Swipe){let e=94,t=17,n=500*X.scale,i=r;A.spring({tension:e,friction:t,maxSpeed:n,restDelta:.1,restSpeed:.1,velocity:i})}else e===h.Pan||f?A.spring({tension:750,friction:17,restDelta:.01,restSpeed:.01,maxSpeed:1}):A.spring({tension:170,friction:17,restDelta:.001,restSpeed:.001,maxSpeed:1/0,velocity:r});e===h.Reset&&0===t.velocity?Z=Object.assign({},X):A.from(Z).to(X).start(),R("action",e)}function ae(){if(!k)return;if(E){const{width:e,height:t}=_();E.style.maxWidth=`min(${e}px, 100%)`,E.style.maxHeight=`min(${t}px, 100%)`}let{x:e,y:t,scale:n,angle:i,flipX:o,flipY:a}=Z;const s=function(){const{width:e,height:t}=_(),{width:n,height:i}=B();if(!c)return{x:0,y:0,width:0,height:0,scale:0,flipX:0,flipY:0,angle:0,fitWidth:n,fitHeight:i,fullWidth:e,fullHeight:t};let{x:o,y:a,scale:s,angle:l,flipX:r,flipY:u}=Z,f=1/Q(),d=e,g=t,h=Z.scale*f,m=X.scale*f;const p=Math.max(n,i),v=Math.min(n,i);e>t?(d=p,g=v):(d=v,g=p);h=e>t?p*s/e||1:p*s/t||1;let b=d?e*m:0,y=g?t*m:0;return o=o+.5*d-.5*b,a=a+.5*g-.5*y,{x:o,y:a,width:b,height:y,scale:d&&g?e*h/b:0,flipX:r,flipY:u,angle:l,fitWidth:n,fitHeight:i,fullWidth:e,fullHeight:t}}();if(s){const{x:e,y:t,width:n,height:o,scale:a,flipX:l,flipY:r}=s;let c=`translate(${g(e)}px, ${g(t)}px)`;c+=1!==l||1!==r?` scaleX(${g(a*l)}) scaleY(${g(a*r)})`:` scale(${g(a)})`,0!==i&&(c+=` rotate(${i}deg)`),T&&(T.style.width=`${g(n)}px`,T.style.height=`${g(o)}px`,T.style.transform=`${c}`)}R("render")}function se(){let e=X.scale;const t=I("clickAction");let n=J();if(t){let i=[];switch(t){case h.ZoomIn:n=2*e;break;case h.ZoomOut:n=.5*e;break;case h.ToggleCover:i=[J(),K()];break;case h.ToggleFull:i=[J(),Q()];break;case h.ToggleMax:i=[J(),ee()];break;case h.IterateZoom:i=[J(),Q(),ee()];break;case h.Zoom:const t=Q();n=e>=t-.05?J():Math.min(t,2*e)}if(i.length){const t=i.findIndex((t=>t>e+1e-4));n=i[t]||J()}}return n=o(G(),n,ee()),n}function le(){return 3===C&&se()>X.scale}function re(){return 3===C&&se()<X.scale}function ce(){return 3===C&&X.scale<ee()}function ue(){return 3===C&&X.scale>G()}function fe(){return 3===C&&ge()&&!!j&&!N()}function de(){return 3===C&&(null==j?void 0:j.isPointerDown())&&!N()}function ge(){return 3===C&&X.scale>J()}function he(){return 3===C&&X.scale>=Q()}const me={canDrag:fe,canZoomIn:ce,canZoomOut:ue,destroy:function(){R("destroy");for(const e of Object.values(F))null==e||e.destroy(me);for(const e of Y)e();return E&&(E.style.aspectRatio="",E.style.maxWidth="",E.style.maxHeight=""),T&&(T.style.width="",T.style.height="",T.style.transform=""),E=void 0,k=void 0,T=void 0,Z=Object.assign({},p),X=Object.assign({},p),null==A||A.destroy(),A=void 0,null==j||j.destroy(),j=void 0,C=4,me},emit:R,execute:oe,getBoundaries:te,getContainer:function(){return c},getFullDim:_,getGestures:function(){return j},getMousemovePos:V,getOptions:function(){return S},getScale:U,getState:function(){return C},getTransform:function(e){return!0===e?X:Z},getTween:function(){return A},getViewport:function(){return T},getWrapper:function(){return E},init:function(){return C=0,R("init"),function(){for(const[e,t]of Object.entries(Object.assign(Object.assign({},M),S.plugins||{})))if(e&&!F[e]&&t instanceof Function){const n=t();n.init(me),F[e]=n}R("initPlugins")}(),function(){const e=Object.assign(Object.assign({},v.classes),I("classes"));if(!c)return;if(u(c,e.container),k=c.querySelector("."+e.content),!k)return;k.setAttribute("draggable","false"),E=c.querySelector("."+e.wrapper),E||(E=document.createElement("div"),u(E,e.wrapper),k.insertAdjacentElement("beforebegin",E),E.insertAdjacentElement("afterbegin",k));if(T=c.querySelector("."+e.viewport),!T){T=document.createElement("div"),u(T,e.viewport);const t=k.cloneNode(!0);t.removeAttribute("id"),T.insertAdjacentElement("afterbegin",k),E.insertAdjacentElement("afterbegin",t),E.insertAdjacentElement("beforeend",T)}k.style.visibility="",k instanceof HTMLPictureElement&&(k=k.querySelector("img"));T instanceof HTMLPictureElement&&(T=T.querySelector("img"));if(T&&(T.style.visibility="hidden",I("protected"))){T.addEventListener("contextmenu",(e=>{e.preventDefault()}));const e=document.createElement("div");u(e,"f-panzoom__protected"),T.appendChild(e)}R("initLayout")}(),function(){if(!c||!k)return;if(!(k instanceof HTMLImageElement))return void q();C=1,c.classList.add("is-loading"),R("loading");const e=()=>{k&&k instanceof HTMLImageElement&&k.decode().then((()=>{requestAnimationFrame((()=>{q()}))})).catch((()=>{q()}))};if(k instanceof HTMLImageElement&&k.src&&k.complete)return void e();(function(){if(!c)return;if(null==c?void 0:c.querySelector(".f-spinner"))return;const e=I("spinnerTpl"),t=i(e);t&&(t.classList.add("f-spinner"),c.classList.add("is-loading"),null==E||E.insertAdjacentElement("afterbegin",t))})(),k.addEventListener("load",e,!1),k.addEventListener("error",e,!1),Y.push((()=>{null==k||k.removeEventListener("load",e,!1),null==k||k.removeEventListener("error",e,!1)}))}(),me},isDragging:de,isExpanded:ge,isFullsize:he,localize:function(e,t=[]){const n=I("l10n")||{};e=String(e).replace(/\{\{(\w+)\}\}/g,((e,t)=>n[t]||e));for(let n=0;n<t.length;n++)e=e.split(t[n][0]).join(t[n][1]);return e=e.replace(/\{\{(.*?)\}\}/g,((e,t)=>t))},off:function(e,t){for(const n of e instanceof Array?e:[e])P.has(n)&&P.set(n,P.get(n).filter((e=>e!==t)));return me},on:function(e,t){for(const n of e instanceof Array?e:[e])P.set(n,[...P.get(n)||[],t]);return me},version:"6.0.27",willZoomIn:le,willZoomOut:re};return me};M.l10n={en_EN:c},M.getDefaults=()=>v;export{p as PANZOOM_DEFAULT_POS,M as Panzoom,h as PanzoomAction,m as PanzoomZoomLevel};
